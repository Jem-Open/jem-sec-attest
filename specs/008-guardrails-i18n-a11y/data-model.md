# Data Model: 008 Platform Guardrails, i18n & Accessibility

**Date**: 2026-02-22

## Entities

### Audit Event (existing collection: `audit_events`)

Extends the existing audit event structure with new event types.

| Field | Type | Description |
|-------|------|-------------|
| id | UUID | Auto-generated by StorageAdapter |
| eventType | string | One of: `sign-in`, `sign-out`, `auth-failure`, `auth-config-error`, `session-started`, `module-completed`, `quiz-submitted`, `evaluation-completed`, `remediation-initiated`, `session-abandoned`, `session-exhausted`, **`evidence-exported`**, **`integration-push-success`**, **`integration-push-failure`** |
| tenantId | string | Tenant scope |
| employeeId | string | nullable — null for system-initiated events |
| timestamp | ISO 8601 string | Event occurrence time |
| metadata | object | Event-type-specific payload (see below) |

**New event metadata shapes**:

```
evidence-exported:
  sessionId: string
  format: "pdf"
  evidenceId: string

integration-push-success:
  sessionId: string
  provider: "sprinto"
  uploadId: string
  evidenceId: string

integration-push-failure:
  sessionId: string
  provider: "sprinto"
  error: string
  evidenceId: string
```

**Immutability constraint**: No `update()` or `delete()` operations are permitted on the `audit_events` collection. Enforced at the application layer via the `AuditLogger` service.

### Training Module (existing collection: `training_modules`)

Fields affected by redaction:

| Field Path | Redaction Applied |
|------------|-------------------|
| `scenarioResponses[].freeTextResponse` | Yes — redact before storage |
| `quizAnswers[].freeTextResponse` | Yes — redact before storage |
| `scenarioResponses[].llmRationale` | Yes — redact before storage |
| `quizAnswers[].llmRationale` | Yes — redact before storage |

When tenant has `retention.transcripts.enabled: false`:
- `freeTextResponse` fields are stored as `null`
- `llmRationale` fields are stored as `null`
- Scores and selected options are preserved

### Retention Policy (tenant YAML config)

Added to `TenantSettingsSchema.retention`:

```yaml
retention:
  days: 365          # existing field
  transcripts:
    enabled: true     # default: true. false = never store free-text content
    retentionDays: 90 # default: null (indefinite). Days before purge.
```

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| transcripts.enabled | boolean | true | Whether to store free-text responses and LLM rationale |
| transcripts.retentionDays | number \| null | null | Days after which transcript content is purged. null = indefinite |

### Locale Resource (file-based, not stored in DB)

```
src/i18n/locales/
  en.json    # canonical, complete
  fr.json    # sample, may be partial (falls back to en)
```

**Structure**: Flat dot-notation keys mapped to translated strings.

```json
{
  "training.quiz.submitButton": "Submit Answer",
  "training.quiz.resultCorrect": "Correct!",
  "training.module.title": "Module {number}: {title}",
  "auth.signin.heading": "Sign in to your organization",
  "common.loading": "Loading..."
}
```

Interpolation uses `{variableName}` placeholders.

## Relationships

```
TenantConfig (YAML)
  └── retention.transcripts → controls TrainingModule transcript storage & purge

TrainingModule
  └── scenarioResponses[].freeTextResponse → redacted by SecretRedactor before write
  └── quizAnswers[].freeTextResponse → redacted by SecretRedactor before write

AuditEvent
  └── references sessionId, employeeId, tenantId (no foreign keys — document store)

LocaleResource (files)
  └── loaded by i18n module, selected via browser cookie/localStorage
```

## State Transitions

No new state machines. The existing session state machine is unchanged. The `TERMINAL_STATUSES` set (`passed`, `exhausted`, `abandoned`) is used by the purge function to determine which sessions' transcripts are eligible for purge.
